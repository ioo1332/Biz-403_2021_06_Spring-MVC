<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.callor.gallery.persistance.ext.GalleryDao">

	<select id="selectAll" resultType="GalleryDTO">
		SELECT * FROM tbl_gallery
		ORDER BY g_date DESC, g_time DESC
	</select>
	
	<select id="findById" resultType="GalleryDTO">
		SELECT*FROM tbl_gallery 
		WHERE g_seq=#{g_seq}
	</select>
	
	<select id="findByIdGalleryFiles" resultType="GalleryFilesDTO">
	SELECT G.g_seq AS g_seq,
		G.g_writer AS g_writer,
        G.g_date AS g_date,
        G.g_time AS g_time,
        G.g_subject AS g_subject,
        G.g_content AS g_content,
        G.g_image AS g_gimage,
		F.file_seq AS f_seq,
        F.file_original AS f_original,
        F.file_upname AS f_upname
	FROM tbl_gallery G ,tbl_files F
		WHERE G.g_seq=#{g_seq} 
		AND G.g_seq=F.file_gseq
	</select>
	<!-- insert,update tag에서는 selectKey라는 내부 tag를 사용할수 있다
		insert,update가 실행되기전,후 에 다른 sql문을 실행하고자 할때
		
		insert를 수행한후 (order='AFTER') 에 last_insert_id 함수를 실행하여
		GalleryDTO의 g_seq칼럼에 값을 담아라 
	 -->
	<insert id="insert" parameterType="GalleryDTO">
		INSERT INTO tbl_gallery(
			g_writer,
			g_date,
			g_time,
			g_subject,
			g_content,
			g_image
		)VALUES(	
			#{g_writer},
			#{g_date},
			#{g_time},
			#{g_subject},
			#{g_content},
			#{g_image}
		)
	<selectKey keyProperty="g_seq" order="AFTER" resultType="Long">
		SELECT LAST_INSERT_ID()
	</selectKey>	
	</insert>
	<update id="update"></update>
	<delete id="delete"></delete>

	<!-- 현재 프로젝트에서 프로젝트를 run 하면
		table이 없으면 새로생성하도록 작성
		ddl 명령어 create drop alter
		
		다수의 table에 대하여 sql문이 실행되고
		table에 저장된 데이터의 변화가 생길때
		job모두 정상적으로 생되었을때는 commit을 하여 데이터 변화를 완성하고
		중간에 사소한 exception이라도 발생하면 모든작업을 rollback하여
		데이터 베이스의 무결성을 보장하는 한자기의 규칙이며 코드작성원칙
		
		transaction이 진해오디는 도중에 다른 task에서
		ddl이 실행되거나 tcl이 실행되면 현재 task에서 실행되는
		transaction
		 -->
	<update id="create_table">
		CREATE TABLE IF NOT EXISTS tbl_gallery(
		g_seq BIGINT AUTO_INCREMENT PRIMARY KEY,
		g_writer VARCHAR(125) NOT NULL ,
		g_date VARCHAR(10) NOT NULL ,
		g_time VARCHAR(10) NOT NULL ,
		g_subject VARCHAR(50) NOT NULL ,
		g_content VARCHAR(1000) NOT NULL,
		g_image VARCHAR(256)
		)

	</update>

</mapper> 