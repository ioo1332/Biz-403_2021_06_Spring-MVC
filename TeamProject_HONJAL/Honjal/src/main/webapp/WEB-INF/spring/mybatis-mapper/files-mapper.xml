<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
 <mapper namespace="com.honjal.honjal.dao.ext.FileDao">
 <select id="selectAll"></select>
 	<select id="findById" resultType="FileDTO">
 		SELECT * FROM tbl_file
 		WHERE file_num = #{file_num}
 	</select>
 	
 	<!-- 개별적으로 한개 데이터씩 Insert -->
 	<insert id="insert" parameterType="FileDTO">
 		INSERT INTO tbl_file (
 			file_num, 	file_originname, 	file_upname
 		) VALUES (
	 		#{file_num},	#{file_originname},	#{file_upname}
 		)
 	</insert>
 	
 	<!-- 
 	f_seq 값이 있는(이미 저장된 데이터) 데이터 추가하려고 할때
 	PK 값이 중복되어 내부에서 UNIQUE Exception이 발생하는데
 	이 Exception을 catch하여 Update로 전환하는 MySQL 고유 SQL 명령을
 	사용하여 Insert Or Update를 수행하는 방법
 	
 	이 문법을 사용하기 위하여 file_seq 데이터를 INSERT하도록 
 	선행 코드가 필요하다
 	-->
 	<insert id="insertOrUpdate"  parameterType="FileDTO">
 		INSERT INTO tbl_file (
 			file_num, file_originname, file_upname
 		) VALUES (
	 		#{file_num}, #{file_originname},	#{file_upname}
 		)
 		ON DUPLICATE KEY UPDATE
 			file_num = #{file_num},
 			file_originname = #{file_originname},
 			file_upname = #{file_upname}
 	</insert>

 	
 	<!-- List<DTO>에 담긴 데이터를 한꺼번에 Insert -->
 	<insert id="insertWithList"  parameterType="FileDTO">
 		INSERT INTO tbl_file (file_num, file_originname,file_upname )
 		VALUES 
 		<foreach collection="filesList" item="file" separator=", " >
 			(
	 			#{file.file_num},	
	 			#{file.file_originname},	
	 			#{file.file_upname}
 			)
 		</foreach>
 	</insert>

	<!-- List<DTO>에 담긴 데이터를 Insert Or Update 수행하기 -->
 	<insert id="insertOrUpdateWithList"  parameterType="FileDTO">
 		INSERT INTO tbl_file
 			(file_num, file_originname,file_upname )
 		VALUES 
 		<foreach collection="filesList" item="file" separator=", " >
 			(
 				#{file.file_num},
	 			#{file.file_originname},	
	 			#{file.file_upname}
 			)
 		</foreach>
 		AS NEW(file_num, content_num , file_originname, f_upname )
 		ON DUPLICATE KEY UPDATE
	 		file_num = f_num, 
	 		file_originname = f_originname,
	 		file_upname = f_upname
 	</insert>

 	<update id="update"></update>
 </mapper>